/*******************************************************************************
    Copyright (C) 2023 Kevin Sahr

    This file is part of DGGRID.

    DGGRID is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    DGGRID is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.
*******************************************************************************/
////////////////////////////////////////////////////////////////////////////////
//
// DgZ7StringRF.h: DgZ7StringRF header file
//
////////////////////////////////////////////////////////////////////////////////

#ifndef DGZ7RF_H
#define DGZ7RF_H

#include <climits>
#include <iostream>

#include <dglib/DgConverter.h>
#include <dglib/Dg2WayConverter.h>
#include <dglib/DgNdxHierCPI.h>

class DgZ7StringCoord;
class DgZ7StringStringRF;
class DgZ7StringStringCoord;
class DgIDGGBase;
class DgZ7StringCoord;
class DgIDGGSBase;

//using namespace std;

////////////////////////////////////////////////////////////////////////////////
class DgZ7StringStringtoZ7Converter :
        public DgConverter<DgZ7StringStringCoord, long long int, DgZ7StringCoord, long long int>
{
   public:

      DgZ7StringStringtoZ7Converter (const DgRF<DgZ7StringStringCoord, long long int>& from,
                                   const DgRF<DgZ7StringCoord, long long int>& to);

      virtual DgZ7StringCoord convertTypedAddress
                                (const DgZ7StringStringCoord& addIn) const;

   private:

      int res_;
};

////////////////////////////////////////////////////////////////////////////////
class DgZ7StringToZ7StringConverter :
        public DgConverter<DgZ7StringCoord, long long int, DgZ7StringStringCoord, long long int>
{
   public:

      DgZ7StringToZ7StringConverter (const DgRF<DgZ7StringCoord, long long int>& from,
                                   const DgRF<DgZ7StringStringCoord, long long int>& to);

      virtual DgZ7StringStringCoord convertTypedAddress
                                (const DgZ7StringCoord& addIn) const;

   private:

      int res_;
};

////////////////////////////////////////////////////////////////////////////////
class Dg2WayZ7ToStringConverter : public Dg2WayConverter {

   public:

      Dg2WayZ7ToStringConverter (
               const DgRF<DgZ7StringStringCoord, long long int>& fromFrame,
               const DgRF<DgZ7StringCoord, long long int>& toFrame)
         : Dg2WayConverter (*(new DgZ7StringStringtoZ7Converter(fromFrame, toFrame)),
                            *(new DgZ7StringToZ7StringConverter(toFrame, fromFrame)))
                                             {}
};

////////////////////////////////////////////////////////////////////////////////
//
//   Coordinate consisting of a string containing quad number, (aperture 7 hex
//        level indicator), and digit-interleaved radix string
//
class DgZ7StringCoord  {

   public:

      static const DgZ7StringCoord undefDgZ7StringCoord;

      DgZ7StringCoord (void) : value_ (0) { }

      DgZ7StringCoord (uint64_t valIn) : value_ (valIn) { }

      DgZ7StringCoord (const DgZ7StringCoord& coord)
              { value_ = coord.value(); }

      void setValue (uint64_t value) { value_ = value; }

      uint64_t value (void) const { return value_; }

      operator std::string (void) const { return valString(); }

      std::string valString (void) const;

      bool operator== (const DgZ7StringCoord& c) const
          { return value() == c.value(); }

      bool operator!= (const DgZ7StringCoord& c) const
          { return !(*this == c); }

      DgZ7StringCoord& operator= (const DgZ7StringCoord& add)
          {
             if (add != *this) setValue(add.value());

             return *this;
          }

   private:

      uint64_t value_;
};

////////////////////////////////////////////////////////////////////////////////
inline ostream&
operator<< (ostream& stream, const DgZ7StringCoord& coord)
{ return stream << std::string(coord); }

////////////////////////////////////////////////////////////////////////////////
class DgZ7StringRF : public DgRF<DgZ7StringCoord, long long int>, public DgNdxHierCPI {

   public:

      static DgZ7StringRF* makeRF (DgRFNetwork& networkIn, const DgHexIDGGS& hexDggsIn,
                      const std::string& nameIn, int resIn)
         { return new DgZ7StringRF (networkIn, hexDggsIn, nameIn, resIn); }

      int res      (void) const { return res_; }
      int aperture (void) const { return 7; }

      virtual long long int dist (const DgZ7StringCoord& add1,
                        const DgZ7StringCoord& add2) const
                       { return 0; }

      virtual std::string add2str (const DgZ7StringCoord& add) const
                       { return std::string(add); }

      virtual std::string add2str (const DgZ7StringCoord& add, char delimiter)
                                                                         const
                       { return std::string(add); }

      virtual const char* str2add (DgZ7StringCoord* add, const char* str,
                                   char delimiter) const;

      virtual std::string dist2str (const long long int& dist) const
                       { return dgg::util::to_string(dist); }

      virtual long double dist2dbl (const long long int& dist) const
                       { return dist; }

      virtual unsigned long long int dist2int (const long long int& dist) const
                       { return dist; }

      virtual const DgZ7StringCoord& undefAddress (void) const
                            { return DgZ7StringCoord::undefDgZ7StringCoord; }

   protected:

      DgZ7StringRF (DgRFNetwork& networkIn, const DgHexIDGGS& hexDggsIn,
                     const std::string& nameIn, int resIn);

      int res_;
      const DgZ7StringStringRF* z7strRF_;
      const DgZ7StringStringtoZ7Converter* z7strToZ7_;
      const DgZ7StringToZ7StringConverter* z7toZ7str_;

   friend class DgZ7StringStringtoZ7Converter;
};

////////////////////////////////////////////////////////////////////////////////
#endif
